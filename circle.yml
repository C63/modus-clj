machine:
  services:
    - docker

dependencies:
  override:
    - lein with-profile dev_sb uberjar
    - docker info
    - docker build --rm=false -t modus-monolith-clj-api .

test:
  override:
    - docker run -d -p 9200:9200 modus-monolith-clj-api; sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:9200

deployment:
  hub:
    branch: master
    commands:
      - docker login --email=tung.buiduy.91@gmail.com --username=TungTo --password=dc2994e5-26b3-4a53-99fa-d72fece3a3cc registry.heroku.com
      - docker tag modus-monolith-clj-api registry.heroku.com/modus-monolith-api
      - docker push registry.heroku.com/modus-monolith-api
